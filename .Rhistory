for (n in m) {
# Number of times to bootstrap
B <- 1e4
#survey categories
surveys <- as.character(unique(faces$Survey))
#dataframe to hold simulation results
pre.exp <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
post.exp <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
for (j in 1:6) {
sample_faces_pre <- faces %>%
filter(Time == 'Pre',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
sample_faces_post <- faces %>%
filter(Time == 'Post',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
# Vector to store means
m1d <- numeric()
m1n <- numeric()
#pre sample mean and sd
pre_mean <- mean(sample_faces_pre$Total)
pre_sd <- sd(sample_faces_pre$Total)
for (i in 1:B) {
dist <- sample(sample_faces_pre$Total, size = n, replace = T)
m1d[i] <- mean(dist)
dist <- rnorm(n, mean=pre_mean, sd=pre_sd)
m1n[i] <- mean(dist)
}
#vector to store post means
m2d <- numeric()
m2n <- numeric()
#post sample mean and sd
post_mean <- mean(sample_faces_post$Total)
post_sd <- sd(sample_faces_post$Total)
for (i in 1:B) {
dist <- sample(sample_faces_post$Total, size = n, replace = T)
m2d[i] <- mean(dist)
dist <- rnorm(n, mean=post_mean, sd=post_sd)
m2n[i] <- mean(dist)
}
power_data[n / 5, j] <- mean(m2d > m1d)
power_norm[n / 5, j] <- mean(m2n > m1n)
}
}
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power$ControlN <- seq(from=60, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations") +
theme(text = element_text(size = 14))
#how many different n to test
m <- seq(from=5, to=55, by=5)
#power dataframe for non-parametric
power_data <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
#power dataframe for parametric group
power_norm <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
for (n in m) {
# Number of times to bootstrap
B <- 1e4
#survey categories
surveys <- as.character(unique(faces$Survey))
#dataframe to hold simulation results
test <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
control <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
for (j in 1:6) {
sample_faces_test <- faces %>%
filter(Time == 'Post',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
sample_faces_control <- faces %>%
filter(Time == 'Post',
Group == 'Control',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
# Vector to store means
m1d <- numeric()
m1n <- numeric()
#pre sample mean and sd
test_mean <- mean(sample_faces_test$Total)
test_sd <- sd(sample_faces_test$Total)
for (i in 1:B) {
dist <- sample(sample_faces_test$Total, size = n, replace = T)
m1d[i] <- mean(dist)
dist <- rnorm(n, mean=test_mean, sd=test_sd)
m1n[i] <- mean(dist)
}
#vector to store post means
m2d <- numeric()
m2n <- numeric()
#post sample mean and sd
control_mean <- mean(sample_faces_control$Total)
control_sd <- sd(sample_faces_control$Total)
for (i in 1:B) {
dist <- sample(sample_faces_control$Total, size = (60-n), replace = T)
m2d[i] <- mean(dist)
dist <- rnorm((60-n), mean=control_mean, sd=control_sd)
m2n[i] <- mean(dist)
}
power_data[n / 5, j] <- mean(m2d < m1d)
power_norm[n / 5, j] <- mean(m2n < m1n)
}
}
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
faces_avg <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(avg_resp = mean(Response)) %>%
ungroup()
faces_sum <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(avg_resp = sum(Response)) %>%
ungroup()
#histograms of the faces pre data
surveys <- unique(faces_sum$Survey)
par(mfrow=c(2,2))
for (i in 1:2) {
hist((faces_avg %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
hist((faces_sum %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
}
par(mfrow=c(3,2))
for (i in 3:5) {
hist((faces_avg %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
hist((faces_sum %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
}
#histograms of the faces experimental data (diff between pre and post)
wider <- faces_avg %>%
pivot_wider(id_cols = c('Participant #', 'Survey', 'Group'),
names_from = contains(c('Time')),
values_from = c(avg_resp)) %>%
filter(Group == 'Experimental')
#Plot differences in histogram and qq plot
#we're hoping for roughly normal
diff <- wider$Post-wider$Pre
par(mfrow=c(1,1))
hist(diff,
main='Histogram of Differences Between Pre and Post',
breaks=10)
#Some normality issues in the upper tail. clearly a little bit right skewed
require(car)
qqp(diff)
#histograms of the faces experimental data (diff between pre and post)
wider <- faces_sum %>%
pivot_wider(id_cols = c('Participant #', 'Survey', 'Group'),
names_from = contains(c('Time')),
values_from = c(avg_resp)) %>%
filter(Group == 'Experimental')
#Plot differences in histogram and qq plot
#we're hoping for roughly normal
diff <- wider$Post-wider$Pre
par(mfrow=c(1,1))
hist(diff,
main='Histogram of Differences Between Pre and Post',
breaks=10)
#Some normality issues in the upper tail. clearly a little bit right skewed
require(car)
qqp(diff)
surveys <- unique(faces_sum$Survey)
par(mfrow=c(3,2))
for (i in 1:5) {
hist((faces_sum %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
}
surveys <- unique(faces_sum$Survey)
par(mfrow=c(3,2))
for (i in 1:6) {
hist((faces_sum %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
}
library(tidyverse)
theme_set(theme_bw())
#Import file of clean data
faces <- read_csv('../../Data/cleaned_FACES_data.csv', col_types = c('ffffdf'))
faces_sum <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(avg_resp = sum(Response)) %>%
ungroup()
View(faces_sum)
View(faces_sum)
View(faces_sum)
#Plot histogram of pre sums
power %>%
filter(Time == 'Pre') %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#Plot histogram of pre sums
power %>% faces_sum %>%
filter(Time == 'Pre') %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#Gruup data into sums
faces_sum <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(resp = sum(Response)) %>%
ungroup()
#Gruup data into sums
faces_sum <- faces %>% filter(Time == 'Pre')
#Gruup data into sums
faces_sum <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(resp = sum(Response)) %>%
ungroup()
#faces pre
faces_pre <- faces_sum %>% filter(Time == 'Pre')
View(faces_pre)
#Plot histogram of pre sums
faces_pre %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#histograms of the faces experimental data (diff between pre and post)
wider <- faces_sum %>%
pivot_wider(id_cols = c('Participant #', 'Survey', 'Group'),
names_from = contains(c('Time')),
values_from = c(resp)) %>%
filter(Group == 'Experimental')
View(wider)
wider$diff <- wider$Post - wider$Pre
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#Plot histogram of pre sums by survey
faces_pre %>%
ggplot(aes(x = resp)) +
geom_histogram(size = 1, alpha = .75) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(size = 1, alpha = .75) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
View(wider)
##power calcs on test vs control group post
wider <- faces_avg %>%
pivot_wider(id_cols = c('Participant #', 'Survey', 'Time'),
names_from = contains(c('Group')),
values_from = c(avg_resp)) %>%
filter(Time == 'Post')
faces_avg <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(avg_resp = mean(Response)) %>%
ungroup()
faces_sum <- faces %>%
group_by(Group, `Participant #`, Time, Survey) %>%
summarise(avg_resp = sum(Response)) %>%
ungroup()
#histograms of the faces pre data
surveys <- unique(faces_sum$Survey)
par(mfrow=c(3,2))
for (i in 1:6) {
hist((faces_sum %>% filter(Time == 'Pre', Survey==surveys[i]))$avg_resp,
main=paste('Histogram for ', surveys[i]),
breaks=10
)
}
#histograms of the faces experimental data (diff between pre and post)
wider <- faces_sum %>%
pivot_wider(id_cols = c('Participant #', 'Survey', 'Group'),
names_from = contains(c('Time')),
values_from = c(avg_resp)) %>%
filter(Group == 'Experimental')
#Plot differences in histogram and qq plot
#we're hoping for roughly normal
diff <- wider$Post-wider$Pre
par(mfrow=c(1,1))
hist(diff,
main='Histogram of Differences Between Pre and Post',
breaks=10)
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(size = 1, alpha = .75, bins = 30) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider$diff <- wider$Post - wider$Pre
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(size = 1, alpha = .75, bins = 30) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(size = 1, alpha = .75, bins = 10) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = diff)) +
geom_histogram(size = 1, alpha = .75, bins = 20) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_histogram(size = 1, alpha = .75, bins = 20) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_histogram(size = 1, alpha = .75, bins = 15) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#Plot histogram of pre sums by survey
faces_pre %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_histogram(aes(color='red'),
size = 1, alpha = .75, bins = 15) +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_histogram(aes(color='red'),
size = 1, alpha = .75, bins = 15) +
theme(legend.position = "none") +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_qq_line()
wider %>%
ggplot(aes(x = scale(diff))) +
geom_qq_line(distribution = stats::qnorm)
wider %>%
ggplot(aes(sample = scale(diff))) +
geom_qq_line()
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq() + stat_qq_line()
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color=('blue'))) + stat_qq_line(aes(color=('blue')))
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color=('blue'))) + stat_qq_line(aes(color=('yellow')))
wider %>%
ggplot(aes(sample = scale(diff), color='blue')) +
stat_qq() + stat_qq_line()
wider %>%
ggplot(aes(sample = scale(diff), coluor='blue')) +
stat_qq() + stat_qq_line()
wider %>%
ggplot(aes(sample = scale(diff), colour='blue')) +
stat_qq() + stat_qq_line()
ggplot(aes(sample = scale(diff), colour) +
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color='darkred')) + stat_qq_line()
wider %>%
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color='darkred')) + stat_qq_line()
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color='darkred')) + stat_qq_line(aes(color='darkred')) +
theme(legend.position = "none")
wider %>%
ggplot(aes(sample = scale(diff))) +
stat_qq(aes(color='darkred')) + stat_qq_line(aes(color='darkred')) +
theme(legend.position = "none") +
labs(x = "Standardized Differences",
title = "QQ Plot of Standardized Differnces", y = '')
#Plot histogram of pre sums by survey
faces_pre %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
#Plot histogram of pre sums by survey
faces_pre %>%
ggplot(aes(x = resp)) +
geom_histogram(aes(color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Survey Reponse Sums",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
wider %>%
ggplot(aes(x = scale(diff))) +
geom_histogram(aes(color='red'),
size = 1, alpha = .75, bins = 15) +
theme(legend.position = "none") +
labs(x = "Standardized Differences",
title = "Pre-Intervention Distributions") +
theme(text = element_text(size = 14))
View(wider)
