#power dataframe for non-parametric
power_data <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
#power dataframe for parametric group
power_norm <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
for (n in m) {
# Number of times to bootstrap
B <- 1e4
#survey categories
surveys <- as.character(unique(faces$Survey))
#dataframe to hold simulation results
test <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
control <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
for (j in 1:6) {
sample_faces_test <- faces %>%
filter(Time == 'Post',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
sample_faces_control <- faces %>%
filter(Time == 'Post',
Group == 'Control',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
# Vector to store means
m1d <- numeric()
m1n <- numeric()
#pre sample mean and sd
test_mean <- mean(sample_faces_test$Total)
test_sd <- sd(sample_faces_test$Total)
for (i in 1:B) {
dist <- sample(sample_faces_test$Total, size = n, replace = T)
m1d[i] <- mean(dist)
dist <- rnorm(n, mean=test_mean, sd=test_sd)
m1n[i] <- mean(dist)
}
#vector to store post means
m2d <- numeric()
m2n <- numeric()
#post sample mean and sd
control_mean <- mean(sample_faces_control$Total)
control_sd <- sd(sample_faces_control$Total)
for (i in 1:B) {
dist <- sample(sample_faces_control$Total, size = (60-n), replace = T)
m2d[i] <- mean(dist)
dist <- rnorm((60-n), mean=control_mean, sd=control_sd)
m2n[i] <- mean(dist)
}
power_data[n / 5, j] <- mean(m2d < m1d)
power_norm[n / 5, j] <- mean(m2n < m1n)
}
}
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number(scale = 0.01))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number(scale = 0.01))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number(scale = 0.01)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 0.01)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 0.1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
for (n in m) {
# Number of times to bootstrap
B <- 1e4
#survey categories
surveys <- as.character(unique(faces$Survey))
#dataframe to hold simulation results
test <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
control <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
for (j in 1:6) {
sample_faces_test <- faces %>%
filter(Time == 'Post',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
sample_faces_control <- faces %>%
filter(Time == 'Post',
Group == 'Control',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
# Vector to store means
m1d <- numeric()
m1n <- numeric()
#pre sample mean and sd
test_mean <- mean(sample_faces_test$Total)
test_sd <- sd(sample_faces_test$Total)
for (i in 1:B) {
dist <- sample(sample_faces_test$Total, size = n, replace = T)
m1d[i] <- mean(dist)
dist <- rnorm(n, mean=test_mean, sd=test_sd)
m1n[i] <- mean(dist)
}
#vector to store post means
m2d <- numeric()
m2n <- numeric()
#post sample mean and sd
control_mean <- mean(sample_faces_control$Total)
control_sd <- sd(sample_faces_control$Total)
for (i in 1:B) {
dist <- sample(sample_faces_control$Total, size = (60-n), replace = T)
m2d[i] <- mean(dist)
dist <- rnorm((60-n), mean=control_mean, sd=control_sd)
m2n[i] <- mean(dist)
}
power_data[n / 5, j] <- mean(m2d < m1d)
power_norm[n / 5, j] <- mean(m2n < m1n)
}
}
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 14))
ggsave('Post Survey Power Calcs.png', width = 16, height = 9, units = 'in')
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 16))
ggsave('Post Survey Power Calcs.png', width = 16, height = 9, units = 'in')
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 18))
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=55, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
scale_y_continuous(labels = scales::number_format(scale = 1)) +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations - Post Survey Results: Experimental vs Control",
caption = 'Control Group Sample Size = 60 - Experimental Group Sample Size') +
theme(text = element_text(size = 26))
ggsave('Post Survey Power Calcs.png', width = 16, height = 9, units = 'in')
library(tidyverse)
theme_set(theme_bw())
faces <- read_csv('../../Data/cleaned_FACES_data.csv', col_types = c('ffffdf'))
#how many different n to test
m <- seq(from=5, to=60, by=5)
#power dataframe for non-parametric
power_data <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
#power dataframe for parametric group
power_norm <- data.frame('FACES' = numeric(length(m)), 'AKS' = numeric(length(m)),
'FES' = numeric(length(m)), 'SCS' = numeric(length(m)),
'FPPS' = numeric(length(m)), 'SEAS' = numeric(length(m)))
for (n in m) {
# Number of times to bootstrap
B <- 1e4
#survey categories
surveys <- as.character(unique(faces$Survey))
#dataframe to hold simulation results
pre.exp <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
post.exp <- data.frame('FACES' = numeric(B), 'AKS' = numeric(B), 'FES' = numeric(B),
'SCS' = numeric(B), 'FPPS' = numeric(B), 'SEAS' = numeric(B))
for (j in 1:6) {
sample_faces_pre <- faces %>%
filter(Time == 'Pre',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
sample_faces_post <- faces %>%
filter(Time == 'Post',
Group == 'Experimental',
Survey == surveys[j]) %>%
group_by(`Participant #`) %>%
summarise(Total = sum(Response)) %>%
ungroup()
# Vector to store means
m1d <- numeric()
m1n <- numeric()
#pre sample mean and sd
pre_mean <- mean(sample_faces_pre$Total)
pre_sd <- sd(sample_faces_pre$Total)
for (i in 1:B) {
dist <- sample(sample_faces_pre$Total, size = n, replace = T)
m1d[i] <- mean(dist)
dist <- rnorm(n, mean=pre_mean, sd=pre_sd)
m1n[i] <- mean(dist)
}
#vector to store post means
m2d <- numeric()
m2n <- numeric()
#post sample mean and sd
post_mean <- mean(sample_faces_post$Total)
post_sd <- sd(sample_faces_post$Total)
for (i in 1:B) {
dist <- sample(sample_faces_post$Total, size = n, replace = T)
m2d[i] <- mean(dist)
dist <- rnorm(n, mean=post_mean, sd=post_sd)
m2n[i] <- mean(dist)
}
power_data[n / 5, j] <- mean(m2d > m1d)
power_norm[n / 5, j] <- mean(m2n > m1n)
}
}
#combine the data frames and change the column names
power <- cbind(power_data, power_norm)
colNames <- c('FACESd', 'AKSd', 'FESd', 'SCSd', 'FPPSd', 'SEASd',
'FACESn', 'AKSn', 'FESn', 'SCSn', 'FPPSn', 'SEASn')
colnames(power) <- colNames
#add indexing for the graph
power$ExpN <- m
power$ControlN <- seq(from=60, to=5, by=-5)
power %>%
select(ExpN, ends_with('d')) %>%
pivot_longer(-ExpN, names_to = 'Survey', values_to = 'Proportion True') %>%
mutate(Survey = str_replace(Survey, 'd', ''),
Survey = factor(Survey)) %>%
ggplot(aes(x = ExpN)) +
geom_line(aes(y = `Proportion True`, color = Survey),
size = 1, alpha = .75) +
facet_wrap(Survey ~., scales = 'free_y') +
labs(x = "Experimental Group Sample Size",
title = "Power Calculations for Pre versus Post Experimental Group") +
theme(text = element_text(size = 26))
ggsave('Pre vs Post Experimental Power Calcs.png', width = 16, height = 9, units = 'in')
rank
rank_sum
x2 <- c(3, 4, -5, 1)
x1 <- c(1, 2, 3, -4)
sum(x1)
sum(x2)
x1 - x2
sign(-1)
sign(-11)
sort(x1 - x2)
diff <- (x1 - x2)
sort(abs(diff))
data.frame(x1 = x1,
x2 = x2,
d  = x1 - x2)
data.frame(x1 = x1,
x2 = x2,
d  = x1 - x2,
s  = sign(d))
data.frame(x1 = x1,
x2 = x2,
d  = x1 - x2,
s  = sign(x1 - x2))
df <- data.frame(x1 = x1,
x2 = x2,
d  = x1 - x2,
s  = sign(x1 - x2))
df
arrange(df, abs(d))
arrange(df, abs(d)) %>%
mutate(rank = c(1.5, 1.5, 3, 4))
arrange(df, abs(d)) %>%
mutate(rank = c(1.5, 1.5, 3, 4)) %>%
mutate(sr   = rank * s)
df_test <- arrange(df, abs(d)) %>%
mutate(rank = c(1.5, 1.5, 3, 4)) %>%
mutate(sr   = rank * s)
df_test$sr %>% sum()
df_test$sr %>% sum() / (1+2+3+4)
wilcox.test(x1, x2)
wilcox.test(x1, x2, paired = T)
w_test <- wilcox.test(x1, x2, paired = T)
w_test$statistic
df_test
w_test <- wilcox.test(x2, x1, paired = T)
w_test$statistic
df <- data.frame(x1 = x1,
x2 = x2,
d  = x2 - x1,
s  = sign(x2 - x1))
df_test <- arrange(df, abs(d)) %>%
mutate(rank = c(1.5, 1.5, 3, 4)) %>%
mutate(sr   = rank * s)
df_test
w_test <- wilcox.test(x1, x2, paired = T)
w_test$statistic
w_test
