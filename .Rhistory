mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff = Post - Pre)
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Std = (Post - Pre)/Pre)
ggplot() +
geom_boxplot(aes(x = Time, y = Diff_Pct)) +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Time, y = Diff_Pct)) +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(y = Diff_Pct)) +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct)) +
facet_wrap(Survey~, scales = 'free_y') +
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '') +
scale_y_continuous(labels = scales::percent_format())
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '') +
scale_y_continuous(labels = scales::percent_format(),
breaks = scales::pretty_breaks(10))
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '') +
scale_y_continuous(labels = scales::percent_format(),
breaks = scales::pretty_breaks(7))
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '') +
scale_y_continuous(labels = scales::percent_format(accuracy = 1),
breaks = scales::pretty_breaks(7))
caption = 'Calculation: Post - Pre %Difference) +
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Differences between Pre and Post Total Scores',
x = '',
y = 'Percent Difference',
caption = 'Calculation: Post - Pre %Difference') +
scale_y_continuous(labels = scales::percent_format(accuracy = 1),
breaks = scales::pretty_breaks(7))
library(tidyverse)
source('../Data_Munging/FACES_fns.R')
theme_set(theme_bw())
faces_tbl %>%
filter(Category == 'mean') %>%
ggplot() +
geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Mean Response per Group x Survey',
x = '')
ggsave(filename = 'mean_comp.png', width = 9, height = 16, units = 'in')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
ggplot() +
geom_boxplot(aes(x = Time, y = Total_Score, fill = Time), position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '')
ggsave(filename = 'total_comp.png', width = 9, height = 16, units = 'in')
faces_tbl %>%
filter(Category == 'mean') %>%
ggplot() +
geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Mean Response per Group x Survey',
x = '',
y = 'Mean of Response')
ggsave(filename = 'mean_comp.png', width = 9, height = 16, units = 'in')
faces_tbl %>%
filter(Category == 'mean') %>%
ggplot() +
geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Mean Response per Group x Survey',
x = '',
y = 'Mean of Response',
caption = 'Mean calculated from all participants in same group + survey + time')
ggsave(filename = 'mean_comp.png', width = 9, height = 16, units = 'in')
faces_tbl %>%
filter(Category == 'mean') %>%
ggplot() +
geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Mean Response per Group x Survey',
x = '',
y = 'Mean of Response',
caption = 'Mean calculated from all participants \n
from a sum of their responses (1-5) score. \n
Only individuals in the  same Group + Survey + Time were averaged')
faces_tbl %>%
filter(Category == 'mean') %>%
ggplot() +
geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Mean Response per Group x Survey',
x = '',
y = 'Mean of Response',
caption = 'Mean calculated from all participants
from a sum of their responses (1-5) score.
Only individuals in the  same Group + Survey + Time were averaged')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
ggplot() +
geom_boxplot(aes(x = Time, y = Total_Score, fill = Time), position = 'dodge') +
facet_grid(Survey~Group, scales = 'free_y') +
labs(title = 'Distribution of Responses per Group x Survey',
x = '',
y = 'Response Score',
caption = 'Response Score is a sum of all responses (1-5)
from a Survey + Group + Time for a single participant.')
ggsave(filename = 'total_comp.png', width = 9, height = 16, units = 'in')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Differences between Pre and Post Total Scores',
x = '',
y = 'Percent Difference',
caption = 'Calculation: Post - Pre %Difference
in response score per Participant.') +
scale_y_continuous(labels = scales::percent_format(accuracy = 1),
breaks = scales::pretty_breaks(7))
ggsave(filename = 'post_vs_pre.png', width = 16, height = 9, units = 'in')
faces %>%
mutate(Survey = factor(Survey)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(Total_Score = sum(Response),
Total_Questions = length(unique(Question))) %>%
ungroup() %>%
mutate(Time     = factor(Time, levels = c('Pre', 'Post')),
Group    = factor(Group),
Survey   = factor(Survey)) %>%
pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
names_from = 'Time',
values_from = 'Total_Score') %>%
mutate(Diff_Pct = (Post - Pre)/Pre) %>%
ggplot() +
geom_boxplot(aes(x = Group, y = Diff_Pct, fill = Group)) +
facet_wrap(Survey~., scales = 'free_y') +
labs(title = 'Distribution of Differences between Pre and Post Total Scores',
x = '',
y = 'Percent Difference',
caption = 'Calculation: Post - Pre %Difference
in response score per Participant + Survey + Group.') +
scale_y_continuous(labels = scales::percent_format(accuracy = 1),
breaks = scales::pretty_breaks(7))
ggsave(filename = 'post_vs_pre.png', width = 16, height = 9, units = 'in')
library(tidyverse)
source('Data_Munging/FACES_fns.R')
# first way, specify data
# fpath <- read_csv('../Data/FACES_data_Spring_2019_AllData.csv')
# format_FACES(data = fpath)
# second way, specify path
# format_FACES(path = '../Data/FACES_data_Spring_2019_AllData.csv') # merged cells?
# third way, just call the fucntion
faces <- format_FACES()
knitr::kable(sample_n(faces, 20))
(missing_sum <- faces %>%
filter(is.na(Response)) %>%
group_by(`Participant #`, Time, Group, Survey) %>%
summarise(missing_data = sum(is.na(Response))) %>%
arrange(missing_data) %>%
ungroup())
keepers <- missing_sum %>%
filter(missing_data <= 2)
throwers <- missing_sum %>%
distinct(`Participant #`, Group, Survey, .keep_all = T) %>% # added to removed Pre and Post
filter(missing_data > 2)
(data_to_remove <- faces %>%
right_join(throwers, by = c('Participant #', 'Group', 'Survey'),
suffix = c('', '_mis')))
(faces_clean <-  setdiff(x = faces, y = select(data_to_remove, -Time_mis, -missing_data)))
# Check that we only took the rows we intended to
nrow(faces_clean) == nrow(faces) - nrow(data_to_remove)
# Check for missing data
anyNA(faces_clean)
(data_to_impute <- faces %>%
right_join(keepers, by = c('Participant #', 'Group', 'Survey', 'Time'),
suffix = c('', '_kp')) %>%
filter(is.na(Response)))
faces_clean2 <- faces_clean %>%
group_by(Time, Group, Survey, Question) %>%
mutate(Response = ifelse(is.na(Response), mean(Response, na.rm = T), Response)) %>%
ungroup()
# To visulize what we changed
data_to_impute %>%
left_join(faces_clean2, by = c('Participant #', 'Time', 'Group', 'Survey', 'Question'),
suffix = c('_mis', '_fill'))
# Should be true
nrow(faces_clean2) == nrow(faces_clean)
# Should be false
anyNA(faces_clean2)
# Saving data
# write_csv(faces_clean2, path = '../Data/cleaned_FACES_data.csv')
(faces_sum <- faces_clean2 %>%
# First group manipulation
group_by(`Participant #`, Survey, Time, Group) %>%
summarise(score = sum(Response),
n_questions = n()) %>%
ungroup() %>%
# Second group manipulation
group_by(Survey, Time, Group) %>%
summarise(mean_participant_score = mean(score),
spl_size = length(unique(`Participant #`)),
question_chk = length(unique(n_questions)) == 1) %>%
ungroup())
faces_clean2
faces_sum
(faces_sum <- faces_clean2 %>%
# First group manipulation
group_by(`Participant #`, Survey, Time, Group) %>%
summarise(score = sum(Response),
n_questions = n()) %>%
ungroup()) #%>%
faces_sum
faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group)) %>%
group_by(Survey) %>%
wilcox.test(score ~ Group)
faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group)) %>%
group_by(Survey) %>%
wilcox.test(x = score, score ~ Group)
faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group)) %>%
group_by(Survey) %>%
wilcox.test(x = score, score ~ Group, data = .)
faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group)) %>%
group_by(Survey)  %>%
wilcox.test(score ~ Group, data = .)
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group)) %>%
group_by(Survey)
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Survey = factor(Survey),
Time = factor(Time),
Group = factor(Group))
surveys <- unique(faces_wilcox$Survey)
surveys
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Time = factor(Time),
Group = factor(Group))
surveys <- unique(faces_wilcox$Survey)
surveys
for (i in surveys) {
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
}
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i, warning = F))
for (i in surveys) {
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i, warning = F))
}
for (i in surveys) {
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
}
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Time = factor(Time),
Group = factor(Group),
score = score + rnorm(1))
for (i in surveys) {
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
}
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Time = factor(Time),
Group = factor(Group),
score = score + rnorm(1))
faces_wilcox
faces_wilcox <- faces_sum %>%
filter(Time == 'Pre') %>%
mutate(Time = factor(Time),
Group = factor(Group),
score = score + rnorm(n()))
for (i in surveys) {
wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
}
wilcoxtests <- list(result = list(), survey = c())
counter <- 1
surveys <- unique(faces_wilcox$Survey)
wilcoxtests <- list(result = list(), survey = c())
counter <- 1
for (i in surveys) {
wilcoxtests$result[counter] <- wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
wilcoxtests$survey[counter] <- i
counter <- counter + 1
}
surveys <- unique(faces_wilcox$Survey)
wilcoxtests <- list(result = list(), survey = c())
counter <- 1
for (i in surveys) {
wilcoxtests$result[[counter]] <- wilcox.test(score ~ Group, data = filter(faces_wilcox, Survey == i))
wilcoxtests$survey[counter] <- i
counter <- counter + 1
}
wilcoxtests
wilcoxtests$result[[1:6]]
wilcoxtests$result[1:6]
wilcoxtests$result[1:6]$p.value
wilcoxtests
