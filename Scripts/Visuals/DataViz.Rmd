---
title: "Data visualizations"
author: "Joseph Oliveira"
date: "6/13/2020"
output: pdf_document
---

# Visualizing the FACES data

```{r message=FALSE, warning=FALSE}
library(tidyverse)
source('../Data_Munging/FACES_fns.R')
theme_set(theme_bw())
```

In the chunk below, I summarise the response from the participants. The mean and median are measures of centrality. The RSD is a measure of consistency.

The columns generated by the summary function are then transposed into a `Value` column and the relative column header, group value, time value are copied into the row of the transposed column.

The column headers were then parsed out into the question category and the applied summary statistic. Then some minor formatting was applied. 

Editing saved to `faces_tbl`. 

```{r message=FALSE, warning=FALSE}
faces <- read_csv("../../Data/cleaned_FACES_data.csv")


faces_tbl <- faces %>% 
  mutate(Survey = factor(Survey)) %>%
  group_by(`Participant #`, Time, Group, Survey) %>%
  summarise(Total_Score = sum(Response),
            Total_Questions = length(unique(Question))) %>%
  ungroup() %>%
  
  # Deselect participant id
  select(-`Participant #`) %>%
  group_by(Group, Time, Survey, Total_Questions) %>%
  
  # Summarise only the responses
  summarise_at('Total_Score', 
               .funs = list('mean' = mean, 'med' = median, 
                            'rsd' = function(x, ...) sd(x, ...)/mean(x, ...)), 
               na.rm = T) %>%
  ungroup() %>%
  
  # Taking the columns generated by the summary function
  pivot_longer(ends_with('mean') | ends_with('med') | ends_with('rsd'),
               names_to = 'Category', values_to = 'Response') %>%
  
  # Parsing out the column headers
  # separate(Category_Summary, into = c('Category', 'Summary'), sep = "_") %>%
  mutate(#Category = str_replace(Category,'[:digit:]', '') %>% 
         #           str_replace('[:digit:]', '')  %>% 
         #           str_trim(side = 'both'),
         
         Category = factor(Category),
         # Summary  = str_trim(Summary, side = 'both'),
         # Summary  = factor(Summary),
         Group    = factor(Group),
         Time     = factor(Time, levels = c('Pre', 'Post')))
  
```


Using the new tbl to generate some visualizations.

```{r}
faces_tbl %>%
  filter(Category == 'mean') %>%
  ggplot() +
  geom_col(aes(x = Category, y = Response, fill = Time), color = 'black', position = 'dodge') +
  facet_grid(Survey~Group, scales = 'free_y') +
  labs(title = 'Mean Response per Group x Survey', 
       x = '',
       y = 'Mean of Response',
       caption = 'Mean calculated from all participants
       from a sum of their responses (1-5) score.
       Only individuals in the  same Group + Survey + Time were averaged')
ggsave(filename = 'mean_comp.png', width = 9, height = 16, units = 'in')
```

```{r}
faces %>% 
  mutate(Survey = factor(Survey)) %>%
  group_by(`Participant #`, Time, Group, Survey) %>%
  summarise(Total_Score = sum(Response),
            Total_Questions = length(unique(Question))) %>%
  ungroup() %>%
  mutate(Time     = factor(Time, levels = c('Pre', 'Post')), 
         Group    = factor(Group),
         Survey   = factor(Survey)) %>%
  ggplot() +
  geom_boxplot(aes(x = Time, y = Total_Score, fill = Time), position = 'dodge') +
  facet_grid(Survey~Group, scales = 'free_y') +
  labs(title = 'Distribution of Responses per Group x Survey', 
       x = '',
       y = 'Response Score',
       caption = 'Response Score is a sum of all responses (1-5) 
       from a Survey + Group + Time for a single participant.')
ggsave(filename = 'total_comp.png', width = 9, height = 16, units = 'in')
```

```{r}
faces %>% 
  mutate(Survey = factor(Survey)) %>%
  group_by(`Participant #`, Time, Group, Survey) %>%
  summarise(Total_Score = sum(Response),
            Total_Questions = length(unique(Question))) %>%
  ungroup() %>%
  mutate(Time     = factor(Time, levels = c('Pre', 'Post')), 
         Group    = factor(Group),
         Survey   = factor(Survey)) %>%
  pivot_wider(id_cols = c('Participant #', 'Group', 'Survey'),
              names_from = 'Time',
              values_from = 'Total_Score') %>%
  mutate(Diff_Pct = (Post - Pre)/Pre,
         Diff = (Post - Pre)) %>%
  ggplot() +
  geom_boxplot(aes(x = Group, y = Diff, fill = Group)) +
  facet_wrap(Survey~., scales = 'free_y') +
  labs(title = 'Distribution of Differences between Pre and Post Total Scores', 
       x = '',
       y = 'Difference',
       caption = 'Calculation: Post - Pre Difference
       in response score per Participant + Survey + Group.') +
  scale_y_continuous(#labels = scales::percent_format(accuracy = 1),
                     breaks = scales::pretty_breaks(7)) +
  theme(text = element_text(size = 17))
ggsave(filename = 'post_vs_pre.png', width = 16, height = 9, units = 'in')
```

